#!/usr/bin/python2.7
import socket, json, time, requests

sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

DISPLAY_CURRENCIES = ['USD']

while True:
    response = requests.get("https://deliver.kenticocloud.com/8b92ac89-4296-4f4f-83c3-8dd8c7625245/items?system.type=slide")
    print(response.text)
    cloudItems = response.json()
    elements = []
    for currency_name in DISPLAY_CURRENCIES:
        print(currency_name)
        #download image
        image = requests.get(cloudItems['items'][0]['elements']['slide_image']['value'][0]['url'])
        with open(cloudItems['items'][0]['elements']['slide_image']['value'][0]['name'],"wb") as f:
                f.write(image.content)
	f.close()
        #End Download Image
        elements.append(dict(
            title = cloudItems['items'][0]['elements']['slide_title']['value'],
            overlay = cloudItems['items'][0]['elements']['simple_overlay_text']['value'],
            background = cloudItems['items'][0]['elements']['slide_image']['value'][0]['name'],
        ))
        

    data = json.dumps(elements, ensure_ascii=False)
    print(data)
    cloudSocket = "KenticoCloud/update:%s"
    SendLoad = cloudSocket % data
    
    sock.sendto(SendLoad.encode("utf8"), ('127.0.0.1', 4444))

    time.sleep(15)
