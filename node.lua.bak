gl.setup(NATIVE_WIDTH, NATIVE_HEIGHT)

local json = require "json"
local font = resource.load_font "font.ttf"
local current_image = resource.load_image("image.jpg")
local elements = {}

node.alias "KenticoCloud"

util.data_mapper{
    update = function(data)
        elements = json.decode(data)
    end
}

function node.render()
    gl.clear(1, 1, 1, 1)
    current_image:draw(0, 0, WIDTH, HEIGHT)
    
    font:write(30, 10, "KenticoCloud", 100, .5,.5,.5,1)
    local y = 120
    for idx, element in ipairs(elements) do
        local line = string.format("%s", element.title)
        font:write(30, y, line, 50, .3,.3,.3,1)
    	y = y + 160
        local line2 = string.format("%s", element.overlay)
	font:write(30, y, line2, 40, .3,.3,.3,1)
        y = y + 160
	local imagename = string.format("%s", element.background)
	local new_image = resource.load_image(imagename)
	current_image = new_image
	current_image:draw(10,10, WIDTH, HEIGHT)
    end
    local new_img = resource.load_image("goat.jpg")
    current_image = new_img
    current_image:draw(10,10,WIDTH,HEIGHT)
  
end
